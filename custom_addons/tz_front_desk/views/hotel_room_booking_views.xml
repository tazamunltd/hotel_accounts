<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="tz_view_room_booking_tree" model="ir.ui.view">
        <field name="name">tz.frontdesk.booking.tree</field>
        <field name="model">tz.frontdesk.booking</field>
        <field name="arch" type="xml">
            <tree string="Room Bookings">
                <field name="date_order" string="Order Date"/>
                <field name="guest_id" string="Guest"/>
                <field name="hotel_room_type" string="Room Type"/>
                <field name="room_count" string="Rooms"/>
                <field name="adult_count" string="Adults"/>
                <field name="no_of_nights" string="Nights"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="tz_view_room_booking_form" model="ir.ui.view">
        <field name="name">tz.frontdesk.booking.form</field>
        <field name="model">tz.frontdesk.booking</field>
        <field name="arch" type="xml">
            <form string="Room Booking">
                <header>
                    <field name="state" widget="statusbar"
                        statusbar_visible="confirmed,block,check_in,check_out,cancel" />
                </header>
                <sheet>
                    <div class="row g-2">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="card mb-2 shadow-sm">
                                <div class="card-header py-1 px-2">
                                    <i class="fa fa-bed m-1"/>
                                    <span class="fw-bold">Guest Information</span>
                                </div>
                                <div class="card-body py-1 px-2">
                                    <div class="row g-2">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="company_id" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="company_id"/>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="name" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="name"/>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="date_order" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="date_order"/>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="guest_id" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="guest_id"/>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="nationality" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="nationality" force_save="1"/>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="ref_id_bk" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="ref_id_bk"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-2 shadow-sm">
                                <div class="card-header py-1 px-2">
                                    <i class="fa fa-cog m-1"/>
                                    <span class="fw-bold">Booking Details</span>
                                </div>
                                <div class="card-body py-1 px-2">
                                    <div class="row g-2">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="rate_code" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="rate_code"/>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="meal_pattern" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="meal_pattern"/>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="card mb-2 shadow-sm">
                                <div class="card-header py-1 px-2">
                                    <i class="fa fa-users m-1"/>
                                    <span class="fw-bold">Room Availability Results</span>
                                </div>
                                <div class="card-body py-1 px-2">
                                    <div class="row g-2">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="checkin_date" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="checkin_date"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="checkout_date" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="checkout_date"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="no_of_nights" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="no_of_nights" readonly="false"/>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="room_count" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="room_count"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="adult_count" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="adult_count"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="child_count" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="child_count"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="infant_count" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="infant_count"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="hotel_room_type" class="form-label small"/>
                                            </div>
                                            <div class="form-control form-control-sm">
                                                <field name="hotel_room_type"
                                                />
                                            </div>
                                        </div>
                                        <hr/>
                                        <field name="room_line_ids" colspan="4" string="Room Lines">
                                            <tree editable="bottom" create="false" delete="false">
<!--                                                <field name="sequence" readonly="1"/>-->
                                                <field name="booked_room_ids" optional="hide" invisible="1"/>
                                                <field name="counter" optional="hide" invisible="1"/>
                                                <field name="fd_state" optional="show"/>
                                                <field name="room_id" string="Room"
                                                       options="{'no_open': True, 'no_create': True}"
                                                       placeholder="Select rooms" optional="show"/>
                                                <field name="hotel_room_type" style="display:none;"
                                                       optional="show"/>
                                                <field name="housekeeping_status" optional="show"/>
                                                <field name="maintenance_status" optional="show"/>
                                                <field name="housekeeping_staff_status" optional="show"/>
                                                <field name="adult_count" readonly="1" invisible="1"
                                                       optional="hide"/>
                                            </tree>
                                        </field>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-2 shadow-sm">
                                <div class="card-header py-1 px-2">
                                    <i class="fa fa-user m-1"/>
                                    <span class="fw-bold">Adult Details</span>
                                </div>
                                <div class="card-body py-1 px-2">
                                    <notebook>
                                        <page string="Adults">
                                            <field name="adult_ids"
                                                   readonly="state in ('check_out')"
                                                   options="{'invisible': [('adult_count', '=', 0)]}">
                                                <tree string="Adults" editable="top" create="false">
                                                    <field name="room_sequence"/>
                                                    <field name="room_type_id" readonly="1"
                                                           options="{'no_open': True}"/>
                                                    <field name="room_id" readonly="1" options="{'no_open': True}"/>
                                                    <field name="first_name"/>
                                                    <field name="last_name"/>
                                                    <!-- <field name="profile" /> -->
                                                    <field name="nationality"/>
                                                    <field name="birth_date"/>
                                                    <field name="passport_number"/>
                                                    <field name="id_number"/>
                                                    <field name="visa_number"/>
                                                    <field name="id_type"/>
                                                    <field name="phone_number"/>
                                                    <field name="relation"/>
                                                </tree>
                                            </field>
                                        </page>
                                        <page string="Children">
                                            <field name="child_ids"
                                                   readonly="state in ('check_out')"
                                                   options="{'invisible': [('child_count', '=', 0)]}">
                                                <tree string="Children" editable="top" create="false">
                                                    <field name="room_sequence"/>
                                                    <field name="room_type_id" readonly="1"
                                                           options="{'no_open': True}"/>
                                                    <field name="room_id" readonly="1" options="{'no_open': True}"/>
                                                    <field name="first_name"/>
                                                    <field name="last_name"/>
                                                    <!-- <field name="profile" /> -->
                                                    <field name="nationality"/>
                                                    <field name="birth_date"/>
                                                    <field name="passport_number"/>
                                                    <field name="id_number"/>
                                                    <field name="visa_number"/>
                                                    <field name="id_type"/>
                                                    <field name="phone_number"/>
                                                    <field name="relation"/>
                                                </tree>
                                            </field>
                                        </page>
                                        <page string="Infant">
                                            <field name="infant_ids"
                                                   readonly="state in ('check_out')"
                                                   options="{'invisible': [('infant_count', '=', 0)]}">
                                                <tree string="Infant" editable="top" create="false">
                                                    <field name="room_sequence"/>
                                                    <field name="room_type_id" readonly="1"
                                                           options="{'no_open': True}"/>
                                                    <field name="room_id" readonly="1" options="{'no_open': True}"/>
                                                    <field name="first_name"/>
                                                    <field name="last_name"/>
                                                    <!-- <field name="profile" /> -->
                                                    <field name="nationality"/>
                                                    <field name="birth_date"/>
                                                    <field name="passport_number"/>
                                                    <field name="id_number"/>
                                                    <field name="visa_number"/>
                                                    <field name="id_type"/>
                                                    <field name="phone_number"/>
                                                    <field name="relation"/>
                                                </tree>
                                            </field>
                                        </page>
                                    </notebook>
                                    <!--<field name="adult_ids">
                                        <tree editable="bottom" string="Adult Guests">
                                            <field name="first_name"/>
                                            <field name="last_name"/>
                                            <field name="nationality"/>
                                            <field name="passport_number"/>
                                            <field name="room_id"/>
                                        </tree>
                                    </field>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
                <div class="oe_chatter" style="margin-top: 20px;">
                    <field name="message_ids" widget="mail_thread"/>
                    <field name="activity_ids" widget="mail_activity"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <!-- Make sure this is properly closed and all fields exist -->
    <!--<record id="tz_view_room_booking_search" model="ir.ui.view">
        <field name="name">tz.frontdesk.booking.search</field>
        <field name="model">tz.frontdesk.booking</field>
        <field name="arch" type="xml">
            <search string="Room Booking Search">
                &lt;!&ndash; Simple search fields &ndash;&gt;
                <field name="guest_id"/>
                <field name="hotel_room_type"/>

                &lt;!&ndash; Basic filter &ndash;&gt;
                <filter string="Recent" name="today"
                        domain="[('date_order','>=',context_today().strftime('%Y-%m-%d'))]"/>

                &lt;!&ndash; Group By &ndash;&gt;
                <group expand="0" string="Group By">
                    <filter string="By Room Type" name="group_type" context="{'group_by':'hotel_room_type'}"/>
                </group>
            </search>
        </field>
    </record>-->

    <!-- Calendar View -->
    <record id="tz_view_room_booking_calendar" model="ir.ui.view">
        <field name="name">tz.frontdesk.booking.calendar</field>
        <field name="model">tz.frontdesk.booking</field>
        <field name="arch" type="xml">
            <calendar string="Room Bookings" date_start="date_order" color="guest_id">
                <field name="guest_id" string="Guest"/>
                <field name="hotel_room_type" string="Room Type"/>
                <field name="room_count" string="Rooms"/>
            </calendar>
        </field>
    </record>

    <!-- Action and Menu Items -->
    <record id="tz_action_room_booking" model="ir.actions.act_window">
        <field name="name">Room Bookings</field>
        <field name="res_model">tz.frontdesk.booking</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Create a new room booking</p>
        </field>
    </record>

    <menuitem id="menu_front_desk_root" name="Front Desk" sequence="0"/>
    <menuitem id="menu_room_booking" name="Room Bookings" parent="menu_front_desk_root" action="tz_action_room_booking"
              sequence="10"/>
</odoo>